(function(){var $block,$event,$eventOneShot,$findName,$mixin,$redirect,$route,$typeOf,$unmixin,Batman,Validators,camelize_rx,capitalize_rx,container,escapeRegExp,filters,helpers,matchContext,mixins,namedOrSplat,namedParam,queryParam,splatParam,underscore_rx1,underscore_rx2,_class,_class2,_objectToString,_stateMachine_setState,__slice=Array.prototype.slice,__hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype;return a},__bind=function(a,b){return function(){return a.apply(b,arguments)}},__indexOf=Array.prototype.indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(this[b]===a)return b;return-1};Batman=function(){var a;a=1<=arguments.length?__slice.call(arguments,0):[];return function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return typeof e=="object"?e:d}(Batman.Object,a,function(){})},Batman.typeOf=$typeOf=function(a){return _objectToString.call(a).slice(8,-1)},_objectToString=Object.prototype.toString,Batman.mixin=$mixin=function(){var a,b,c,d,e,f,g,h,i;f=arguments[0],d=2<=arguments.length?__slice.call(arguments,1):[],e=f.set,a=typeof e=="function";for(h=0,i=d.length;h<i;h++){c=d[h];if($typeOf(c)!=="Object")continue;for(b in c){g=c[b];if(b==="initialize"||b==="uninitialize"||b==="prototype")continue;a?e.call(f,b,g):f[b]=g}}return f},Batman.unmixin=$unmixin=function(){var a,b,c,d,e,f;a=arguments[0],d=2<=arguments.length?__slice.call(arguments,1):[];for(e=0,f=d.length;e<f;e++){c=d[e];for(b in c){if(b==="initialize"||b==="uninitialize")continue;a[b]=null,delete a[b]}typeof c.deinitialize=="function"&&c.deinitialize.call(a)}return a},Batman._block=$block=function(a){var b;return b=function(){var b,c,d;b=1<=arguments.length?__slice.call(arguments,0):[],c=this,d=function(d){b.push(d);return a.apply(c,b)};return typeof b[b.length-1]=="function"?d(b.pop()):d}},Batman._findName=$findName=function(a,b){var c,d;if(!a.displayName)for(c in b){d=b[c];if(d===a){a.displayName=c;break}}return a.displayName},Batman.Property=function(){function a(a,b){this.base=a,this.key=b}a.defaultAccessor={get:function(a){return this[a]},set:function(a,b){return this[a]=b},unset:function(a){this[a]=null,delete this[a]}},a.triggerTracker=null,a["for"]=function(a,b){var c,d;if(a._batman){Batman._initializeObject(a),c=(d=a._batman).properties||(d.properties=new Batman.SimpleHash);return c.get(b)||c.set(b,new this(a,b))}return new this(a,b)},a.prototype.isProperty=!0,a.prototype.accessor=function(){var a,b,c,d,e,f;a=this.key,f=Batman._lookupAllBatmanKeys(this.base,"keyAccessors");for(d=0,e=f.length;d<e;d++){b=f[d];if(c=b.get(a))return c}return Batman._lookupBatmanKey(this.base,"defaultAccessor")||Batman.Property.defaultAccessor},a.prototype.registerAsTrigger=function(){var a;if(a=Batman.Property.triggerTracker)return a.add(this)},a.prototype.getValue=function(){var a;this.registerAsTrigger();return(a=this.accessor())!=null?a.get.call(this.base,this.key):void 0},a.prototype.setValue=function(a){var b;return(b=this.accessor())!=null?b.set.call(this.base,this.key,a):void 0},a.prototype.unsetValue=function(){var a;return(a=this.accessor())!=null?a.unset.call(this.base,this.key):void 0},a.prototype.isEqual=function(a){return this.constructor===a.constructor&&this.base===a.base&&this.key===a.key};return a}(),Batman.ObservableProperty=function(){function a(b,c){a.__super__.constructor.apply(this,arguments),this.observers=new Batman.SimpleSet,this.hasObserversToFire()&&this.refreshTriggers(),this._preventCount=0}__extends(a,Batman.Property),a.prototype.setValue=function(b){this.cacheDependentValues(),a.__super__.setValue.apply(this,arguments),this.fireDependents();return b},a.prototype.unsetValue=function(){this.cacheDependentValues(),a.__super__.unsetValue.apply(this,arguments),this.fireDependents()},a.prototype.cacheDependentValues=function(){if(this.dependents)return this.dependents.each(function(a){return a.cachedValue=a.getValue()})},a.prototype.fireDependents=function(){if(this.dependents)return this.dependents.each(function(a){if(typeof a.hasObserversToFire=="function"?a.hasObserversToFire():void 0)return a.fire(a.getValue(),a.cachedValue)})},a.prototype.observe=function(){var a,b,c,d;c=2<=arguments.length?__slice.call(arguments,0,d=arguments.length-1):(d=0,[]),a=arguments[d++],c=c[0]===!0,b=this.getValue(),this.observers.add(a),this.refreshTriggers(),c&&a.call(this.base,b,b);return this},a.prototype.hasObserversToFire=function(){var a;if(this.observers.length>0)return!0;if(this.base===this.base.constructor.prototype)return!1;return(typeof (a=this.base.constructor).prototype.property=="function"?a.prototype.property(this.key).observers.length:void 0)>0},a.prototype.preventFire=function(){return this._preventCount++},a.prototype.allowFire=function(){if(this._preventCount>0)return this._preventCount--},a.prototype.isAllowedToFire=function(){return this._preventCount<=0},a.prototype.fire=function(){var a,b,c,d,e,f,g,h;a=1<=arguments.length?__slice.call(arguments,0):[];if(!!this.hasObserversToFire()){c=this.key,b=this.base,e=Batman._lookupAllBatmanKeys(this.base),f=[this.observers].concat(e.map(function(a){return a!=null?typeof a.property=="function"?a.property(c).observers:void 0:void 0}));for(g=0,h=f.length;g<h;g++)d=f[g],d!=null&&d.each(function(c){return c!=null?c.apply(b,a):void 0});return this.refreshTriggers()}},a.prototype.forget=function(a){a?this.observers.remove(a):this.observers=new Batman.SimpleSet;if(!this.hasObserversToFire())return this.clearTriggers()},a.prototype.refreshTriggers=function(){Batman.Property.triggerTracker=new Batman.SimpleSet,this.getValue(),this.triggers&&this.triggers.each(__bind(function(a){var b;if(!Batman.Property.triggerTracker.has(a))return(b=a.dependents)!=null?b.remove(this):void 0},this)),this.triggers=Batman.Property.triggerTracker,this.triggers.each(__bind(function(a){a.dependents||(a.dependents=new Batman.SimpleSet);return a.dependents.add(this)},this));return Batman.Property.triggerTracker=null},a.prototype.clearTriggers=function(){this.triggers.each(__bind(function(a){return a.dependents.remove(this)},this));return this.triggers=new Batman.SimpleSet};return a}(),Batman.Keypath=function(){function a(b,c){$typeOf(c)==="String"?(this.segments=c.split("."),this.depth=this.segments.length):(this.segments=[c],this.depth=1),a.__super__.constructor.apply(this,arguments)}__extends(a,Batman.ObservableProperty),a.prototype.slice=function(a,b){var c,d,e,f,g;c=this.base,g=this.segments.slice(0,a);for(e=0,f=g.length;e<f;e++){d=g[e];if(c==null||!(c=Batman.Keypath["for"](c,d).getValue()))return}return Batman.Keypath["for"](c,this.segments.slice(a,b).join("."))},a.prototype.terminalProperty=function(){return this.slice(-1)},a.prototype.getValue=function(){var b;this.registerAsTrigger();return this.depth===1?a.__super__.getValue.apply(this,arguments):(b=this.terminalProperty())!=null?b.getValue():void 0},a.prototype.setValue=function(b){var c;return this.depth===1?a.__super__.setValue.apply(this,arguments):(c=this.terminalProperty())!=null?c.setValue(b):void 0},a.prototype.unsetValue=function(){var b;return this.depth===1?a.__super__.unsetValue.apply(this,arguments):(b=this.terminalProperty())!=null?b.unsetValue():void 0};return a}(),Batman.Observable={isObservable:!0,property:function(a){Batman._initializeObject(this);return Batman.Keypath["for"](this,a)},get:function(a){return this.property(a).getValue()},set:function(a,b){return this.property(a).setValue(b)},unset:function(a){return this.property(a).unsetValue()},observe:function(){var a,b,c;b=arguments[0],a=2<=arguments.length?__slice.call(arguments,1):[],(c=this.property(b)).observe.apply(c,a);return this},fire:function(){var a,b,c;b=arguments[0],a=2<=arguments.length?__slice.call(arguments,1):[];return(c=this.property(b)).fire.apply(c,a)},forget:function(a,b){a?this.property(a).forget(b):this._batman.properties.each(function(a,b){return b.forget()});return this},prevent:function(a){this.property(a).preventFire();return this},allow:function(a){this.property(a).allowFire();return this},allowed:function(a){return this.property(a).isAllowedToFire()}},Batman.EventEmitter={event:$block(function(a,b,c){var d;!c&&typeof b!="undefined"&&(c=b,b=null),!c&&$typeOf(a)!=="String"&&(c=a,a=null),d=function(b){var e,g,h,i,j,k,l;if(!this.observe)throw"EventEmitter requires Observable";Batman._initializeObject(this),a||(a=$findName(d,this)),g=(k=this._batman._oneShotFired)!=null?k[a]:void 0;if(typeof b!="function"){if(this.allowed(a)){if(d.isOneShot&&g)return!1;i=c!=null?c.apply(this,arguments):void 0,i!==!1&&(d._firedArgs=typeof i!="undefined"?(l=[i]).concat.apply(l,arguments):arguments.length===0?[]:Array.prototype.slice.call(arguments),e=Array.prototype.slice.call(d._firedArgs),e.unshift(a),this.fire.apply(this,e),d.isOneShot&&(h=(j=this._batman)._oneShotFired||(j._oneShotFired={}),h[a]=!0));return i}return!1}this.observe(a,b);if(d.isOneShot&&g)return b.apply(this,d._firedArgs)},b&&(d=d.bind(b)),a!=null&&(this[a]=d);return $mixin(d,{isEvent:!0,action:c,isOneShot:this.isOneShot})}),eventOneShot:function(a){return $mixin(Batman.EventEmitter.event.apply(this,arguments),{isOneShot:!0})}},$event=function(a){var b;b=new Batman.Object;return b.event("_event",b,a)},$eventOneShot=function(a){var b;b=new Batman.Object;return b.eventOneShot("_event",b,a)},Batman.StateMachine={initialize:function(){Batman._initializeObject(this);if(!this._batman.states){this._batman.states={};return this.accessor("state",{get:function(){return this.state()},set:function(a,b){return _stateMachine_setState.call(this,b)}})}},state:function(a,b){var c;Batman.StateMachine.initialize.call(this);if(!a)return Batman._lookupBatmanKey(this,"state");if(!this.event)throw"StateMachine requires EventEmitter";c=this[a]||this.event(a,function(){_stateMachine_setState.call(this,a);return!1}),typeof b=="function"&&c.call(this,b);return c},transition:function(a,b,c){var d,e,f;Batman.StateMachine.initialize.call(this),this.state(a),this.state(b),e=""+a+"->"+b,f=this._batman.states,d=f[e]||(f[e]=$event(function(){})),c&&d(c);return d}},_stateMachine_setState=function(a){var b,c,d,e,f,g,h,i;Batman.StateMachine.initialize.call(this);if(this._batman.isTransitioning){((e=this._batman).nextState||(e.nextState=[])).push(a);return!1}this._batman.isTransitioning=!0,d=this.state(),this._batman.state=a;if(a&&d){c=""+d+"->"+a,h=Batman._lookupAllBatmanKeys(this,"states",c);for(f=0,g=h.length;f<g;f++)b=h[f],b&&b(a,d)}a&&this.fire(a,a,d),this._batman.isTransitioning=!1,((i=this._batman.nextState)!=null?i.length:void 0)&&this[this._batman.nextState.shift()]();return a},Batman._initializeObject=function(a){var b;if(a.prototype&&((b=a._batman)!=null?b.__initClass__:void 0)!==a)return a._batman={__initClass__:a};if(!a.hasOwnProperty("_batman"))return a._batman={}},Batman._lookupBatmanKey=function(a,b){var c,d,e,f,g,h;if(d=(e=a._batman)!=null?e[b]:void 0)return d;c=a.constructor;while(c){if(d=(f=c.prototype)!=null?(g=f._batman)!=null?g[b]:void 0:void 0)return d;c=(h=c.__super__)!=null?h.constructor:void 0}},Batman._lookupAllBatmanKeys=function(a,b,c){var d,e,f,g,h,i,j,k,l,m;f=[],(g=(h=a._batman)!=null?h[b]:void 0)&&f.push(g),d=!!a.prototype,e=d?(i=a.__super__)!=null?i.constructor:void 0:a.constructor;while(e)b?d&&(g=(j=e._batman)!=null?j[b]:void 0)?f.push(g):!d&&(g=(k=e.prototype)!=null?(l=k._batman)!=null?l[b]:void 0:void 0)&&f.push(g):f.push(e.prototype),e=(m=e.__super__)!=null?m.constructor:void 0;return c?f.map(function(a){return a[c]}):f},Batman.Object=function(){function a(){var a;a=1<=arguments.length?__slice.call(arguments,0):[],Batman._initializeObject(this),this.mixin.apply(this,a)}a.global=function(a){if(a!==!1)return container[this.name]=this},a.mixin=function(){var a;a=1<=arguments.length?__slice.call(arguments,0):[];return $mixin.apply(null,[this].concat(__slice.call(a)))},a.prototype.mixin=a.mixin,a.accessor=function(){var a,b,c,d,e,f,g,h,i,j,k;c=2<=arguments.length?__slice.call(arguments,0,g=arguments.length-1):(g=0,[]),a=arguments[g++],Batman._initializeObject(this);if(c.length===0){if(a.get||a.set)return this._batman.defaultAccessor=a;(e=this._batman).keyAccessors||(e.keyAccessors=new Batman.SimpleHash),j=[];for(b in a)d=a[b],this._batman.keyAccessors.set(b,{get:d,set:d}),j.push(this[b]=d);return j}(f=this._batman).keyAccessors||(f.keyAccessors=new Batman.SimpleHash),k=[];for(h=0,i=c.length;h<i;h++)b=c[h],k.push(this._batman.keyAccessors.set(b,a));return k},a.prototype.accessor=a.accessor,a.mixin(Batman.Observable,Batman.EventEmitter),a.prototype.mixin(Batman.Observable,Batman.EventEmitter);return a}(),Batman.SimpleHash=function(){function a(){this._storage={},this.length=0}a.prototype.hasKey=function(a){return typeof this.get(a)!="undefined"},a.prototype.get=function(a){var b,c,d,e,f,g;if(a==="length")return this.length;if(b=this._storage[a])for(e=0,f=b.length;e<f;e++){g=b[e],c=g[0],d=g[1];if(this.equality(c,a))return d}},a.prototype.set=function(a,b){var c,d,e,f,g,h;d=(f=this._storage)[a]||(f[a]=[]);for(g=0,h=d.length;g<h;g++)c=d[g],this.equality(c[0],a)&&(e=c);e||(e=[a],d.push(e));return e[1]=b},a.prototype.unset=function(a){var b,c,d,e,f,g;if(c=this._storage[a])for(b=0,f=c.length;b<f;b++){g=c[b],d=g[0],e=g[1];if(this.equality(d,a)){c.splice(b,1);return}}},a.prototype.equality=function(a,b){return typeof a.isEqual=="function"?a.isEqual(b):typeof b.isEqual=="function"?b.isEqual(a):a===b},a.prototype.each=function(a){var b,c,d,e,f,g;f=this._storage,g=[];for(b in f)e=f[b],g.push(function(){var b,f,g,h;h=[];for(b=0,f=e.length;b<f;b++)g=e[b],c=g[0],d=g[1],h.push(a(c,d));return h}());return g},a.prototype.keys=function(){var a;a=[],this.each(function(b){return a.push(b)});return a},a.prototype.clear=function(){return this.each(function(a){return this.unset(a)})},a.prototype.isEmpty=function(){return this.keys().length===0};return a}(),Batman.Hash=function(){function e(){e.__super__.constructor.apply(this,arguments),_class.apply(this,arguments)}var a,b,c,d;__extends(e,Batman.Object),_class=Batman.SimpleHash,e.prototype.accessor({get:Batman.SimpleHash.prototype.get,set:Batman.SimpleHash.prototype.set,unset:Batman.SimpleHash.prototype.unset}),e.prototype.accessor("isEmpty",{get:function(){return this.isEmpty()}}),d=["hasKey","equality","each","keys"];for(b=0,c=d.length;b<c;b++)a=d[b],e.prototype[a]=Batman.SimpleHash.prototype[a];return e}(),Batman.SimpleSet=function(){function e(){this._storage=new Batman.SimpleHash,this.length=0,arguments.length>0&&this.add.apply(this,arguments)}var a,b,c,d;e.prototype.has=function(a){return this._storage.hasKey(a)},d=["get","set","unset"];for(b=0,c=d.length;b<c;b++)a=d[b],e.prototype[a]=Batman.Property.defaultAccessor[a];e.prototype.add=function(){var a,b,c,d;b=1<=arguments.length?__slice.call(arguments,0):[];for(c=0,d=b.length;c<d;c++)a=b[c],this._storage.hasKey(a)||(this._storage.set(a,!0),this.set("length",this.length+1),this.set("isEmpty",!0));return b},e.prototype.remove=function(){var a,b,c,d,e;b=1<=arguments.length?__slice.call(arguments,0):[],c=[];for(d=0,e=b.length;d<e;d++)a=b[d],this._storage.hasKey(a)&&(this._storage.unset(a),c.push(a),this.set("length",this.length-1),this.set("isEmpty",!0));return c},e.prototype.each=function(a){return this._storage.each(function(b,c){return a(b)})},e.prototype.isEmpty=function(){return this.get("length")===0},e.prototype.clear=function(){return this.remove(this.toArray())},e.prototype.toArray=function(){return this._storage.keys()};return e}(),Batman.Set=function(){function h(){h.__super__.constructor.apply(this,arguments),_class2.apply(this,arguments)}var a,b,c,d,e,f,g;__extends(h,Batman.Object),_class2=Batman.SimpleSet,f=["add","remove"];for(b=0,d=f.length;b<d;b++)a=f[b],h.prototype[a]=h.event(Batman.SimpleSet.prototype[a]);g=["has","each","isEmpty","toArray","clear"];for(c=0,e=g.length;c<e;c++)a=g[c],h.prototype[a]=Batman.SimpleSet.prototype[a];h.prototype.accessor("isEmpty",{get:function(){return this.isEmpty()},set:function(){}});return h}(),Batman.SortableSet=function(){function a(b){a.__super__.constructor.apply(this,arguments),this._indexes={},this.addIndex(b)}__extends(a,Batman.Set),a.prototype.add=a.event(function(){var a;a=Batman.SimpleSet.prototype.add.apply(this,arguments),this._reIndex();return a}),a.prototype.remove=a.event(function(){var a;a=Batman.SimpleSet.prototype.remove.apply(this,arguments),this._reIndex();return a}),a.prototype.addIndex=function(a){this._reIndex(a);return this.activeIndex=a},a.prototype.removeIndex=function(a){this._indexes[a]=null,delete this._indexes[a];return a},a.prototype.each=function(a){var b,c,d,e,f;e=toArray(),f=[];for(c=0,d=e.length;c<d;c++)b=e[c],f.push(a(b));return f},a.prototype.toArray=function(){var b,c;return b=(c=this._indexes[this.activeIndex])!=null?c:{ary:a.__super__.toArray.apply(this,arguments)}},a.prototype._reIndex=function(a){var b,c,d,e,f;if(a){e=a.split(" "),c=e[0],d=e[1],b=Batman.Set.prototype.toArray.call(this);return this._indexes[a]=b.sort(function(a,b){var e,f,g,h,i;e=(g=Batman.Observable.property.call(a,c).getValue())!=null?g.valueOf():void 0,f=(h=Batman.Observable.property.call(b,c).getValue())!=null?h.valueOf():void 0,(d!=null?d.toLowerCase():void 0)==="desc"&&(i=[f,e],e=i[0],f=i[1]);return e<f?-1:e>f?1:0})}f=[];for(a in this._indexes)f.push(this._reIndex(a));return f};return a}(),Batman.Request=function(){function a(){a.__super__.constructor.apply(this,arguments)}__extends(a,Batman.Object),a.prototype.url="",a.prototype.data="",a.prototype.method="get",a.prototype.response=null,a.prototype.observe("url",function(){return this._autosendTimeout=setTimeout(__bind(function(){return this.send()},this),0)}),a.prototype.loading=a.event(function(){}),a.prototype.loaded=a.event(function(){}),a.prototype.success=a.event(function(){}),a.prototype.error=a.event(function(){}),a.prototype.send=function(){throw"Please source a dependency file for a request implementation"},a.prototype.cancel=function(){if(this._autosendTimeout)return clearTimeout(this._autosendTimeout)};return a}(),Batman.App=function(){function a(){a.__super__.constructor.apply(this,arguments)}__extends(a,Batman.Object),a.requirePath="",a.require=function(){var a,b,c,d,e,f;d=arguments[0],c=2<=arguments.length?__slice.call(arguments,1):[],a=this.requirePath+d;for(e=0,f=c.length;e<f;e++)b=c[e],this.prevent("run"),d=a+"/"+b+".coffee",new Batman.Request({url:d,type:"html",success:__bind(function(a){CoffeeScript.eval(a),this.allow("run");return this.run()},this)});return this},a.controller=function(){var a;a=1<=arguments.length?__slice.call(arguments,0):[];return this.require.apply(this,["controllers"].concat(__slice.call(a)))},a.model=function(){var a;a=1<=arguments.length?__slice.call(arguments,0):[];return this.require.apply(this,["models"].concat(__slice.call(a)))},a.view=function(){var a;a=1<=arguments.length?__slice.call(arguments,0):[];return this.require.apply(this,["views"].concat(__slice.call(a)))},a.layout=void 0,a.run=a.eventOneShot(function(){if(this.hasRun)return!1;Batman.currentApp=this,typeof this.layout=="undefined"&&this.set("layout",new Batman.View({node:document})),this.startRouting();return this.hasRun=!0});return a}(),namedParam=/:([\w\d]+)/g,splatParam=/\*([\w\d]+)/g,queryParam="(?:\\?.+)?",namedOrSplat=/[:|\*]([\w\d]+)/g,escapeRegExp=/[-[\]{}()+?.,\\^$|#\s]/g,Batman.Route={isRoute:!0,pattern:null,regexp:null,namedArguments:null,action:null,context:null,fire:function(a,b){var c,d,e,f;c=this.action;if($typeOf(c)==="String"&&(f=c.indexOf("#"))!==-1){e=helpers.camelize(c.substr(0,f)+"Controller"),d=Batman.currentApp[e],b=d;if(b!=null?b.sharedInstance:void 0)b=b.sharedInstance();c=b[c.substr(f+1)]}if(c)return c.apply(b||this.context,a)},toString:function(){return"route: "+this.pattern}},$mixin(Batman,{HASH_PATTERN:"#!",_routes:[],route:$block(function(a,b){var c,d,e,f,g;d=function(b){var c,e,f;c=d.context||this,c&&c.sharedInstance&&(c=c.sharedInstance()),a=d.pattern;if(b&&!b.url)for(e in b)f=b[e],a=a.replace(new RegExp("[:|*]"+e),f);if(b&&!b.url||!b)Batman.currentApp._cachedRoute=a,window.location.hash=Batman.HASH_PATTERN+a;return c&&c.dispatch?c.dispatch(d,b):d.fire(arguments,c)},e=a.replace(escapeRegExp,"\\$&"),g=new RegExp("^"+e.replace(namedParam,"([^/]*)").replace(splatParam,"(.*?)")+queryParam+"$"),f=[];while((c=namedOrSplat.exec(e))!=null)c[1]&&f.push(c[1]);$mixin(d,Batman.Route,{pattern:e,regexp:g,namedArguments:f,action:b,context:this}),Batman._routes.push(d);return d}),redirect:function(a){var b;b=(a!=null?a.isRoute:void 0)?a.pattern:a;return window.location.hash=""+Batman.HASH_PATTERN+b}}),Batman.Object.route=Batman.App.route=$route=Batman.route,Batman.Object.redirect=Batman.App.redirect=$redirect=Batman.redirect,$mixin(Batman.App,{startRouting:function(){var a,b;if(typeof window!="undefined"){b=__bind(function(){var a;a=window.location.hash.replace(Batman.HASH_PATTERN,"");if(a!==this._cachedRoute){this._cachedRoute=a;return this._dispatch(a)}},this),window.location.hash||(window.location.hash=""+Batman.HASH_PATTERN+"/"),setTimeout(b,0);if("onhashchange"in window){this._routeHandler=b;return window.addEventListener("hashchange",b)}a=window.location.hash;return this._routeHandler=setInterval(b,100)}},stopRouting:function(){if(this._routeHandler!=null){if("onhashchange"in window){window.removeEventListener("hashchange",this._routeHandler);return this._routeHandler=null}return this._routeHandler=clearInterval(this._routeHandler)}},_dispatch:function(a){var b,c;c=this._matchRoute(a);if(!c)a==="/404"?Batman.currentApp[404]():$redirect("/404");else{b=this._extractParams(a,c);return c(b)}},_matchRoute:function(a){var b,c,d,e;e=Batman._routes;for(c=0,d=e.length;c<d;c++){b=e[c];if(b.regexp.test(a))return b}return null},_extractParams:function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p;n=a.split("?"),a=n[0],h=n[1],c=b.regexp.exec(a).slice(1),g={url:a};for(d=0,l=c.length;d<l;d++)f=c[d],g[b.namedArguments[d]]=f;if(h!=null){o=h.split("&");for(k=0,m=o.length;k<m;k++)i=o[k],p=i.split("="),e=p[0],j=p[1],g[e]=j}return g},root:function(a){return $route("/",a)},404:function(){var a;return a=new Batman.View({html:"<h1>Page could not be found</h1>",contentFor:"main"})}}),Batman.Controller=function(){function a(){a.__super__.constructor.apply(this,arguments)}__extends(a,Batman.Object),a.sharedInstance=function(){this._sharedInstance||(this._sharedInstance=new this);return this._sharedInstance},a.beforeFilter=function(a){var b;b=this._beforeFilters||(this._beforeFilters=[]);return b.push(a)},a.resources=function(a){var b;b=__bind(function(){this.prototype.index&&(this.prototype.index=this.route("/"+a,this.prototype.index)),this.prototype.create&&(this.prototype.create=this.route("/"+a+"/new",this.prototype.create)),this.prototype.show&&(this.prototype.show=this.route("/"+a+"/:id",this.prototype.show));if(this.prototype.edit)return this.prototype.edit=this.route("/"+a+"/:id/edit",this.prototype.edit)},this);return setTimeout(b,0)},a.prototype.dispatch=function(){var a,b,c,d,e,f,g,h;f=arguments[0],d=2<=arguments.length?__slice.call(arguments,1):[],c=$findName(f,this),this._actedDuringAction=!1,this._currentAction=c,b=this.constructor._beforeFilters;if(b)for(g=0,h=b.length;g<h;g++)a=b[g],a.call(this);e=f.fire(d,this),this._actedDuringAction||this.render(),delete this._actedDuringAction;return delete this._currentAction},a.prototype.redirect=function(a){this._actedDuringAction=!0;return $redirect(a)},a.prototype.render=function(a){var b;a==null&&(a={}),this._actedDuringAction=!0,a.view||(a.source=helpers.underscore(this.constructor.name.replace("Controller",""))+"/"+this._currentAction+".html",a.view=new Batman.View(a));if(b=a.view){b.context||(b.context=this);return b.ready(function(){return Batman.DOM.contentFor("main",b.get("node"))})}};return a}(),Batman.Model=function(){function e(a){var b;a==null&&(a={}),this.dirtyKeys=new Batman.Hash,this.errors=new Batman.Set,e.__super__.constructor.apply(this,arguments),this.state()||this.empty(),b=$typeOf(a)==="String"?a:a.id,b!=null&&(this.id=""+b,this.constructor.get("all").add(this))}var a,b,c,d;__extends(e,Batman.Object),e.persist=function(){var a,b,c,d,e,f;b=1<=arguments.length?__slice.call(arguments,0):[],Batman._initializeObject(this.prototype),c=(d=this.prototype._batman).storage||(d.storage=[]);for(e=0,f=b.length;e<f;e++)a=b[e],c.push(a.isStorageAdapter?a:new a(this));return this},e.accessor("all",{get:function(){return this.all||(this.all=new Batman.Set)}}),e.accessor("first",{get:function(){return this.first=this.get("all")[0]}}),e.accessor("last",{get:function(){return this.last=this.get("all")[this.all.length-1]}}),e.find=function(a){var b;if(b=this.get("all").get(a))return b;b=new this(""+a),setTimeout(function(){return b.load()},0);return b},e.beforeLoad=e.event(function(){return this.get("all").clear()}),e.afterLoad=e.event(function(){}),e.load=function(a){var b,c,d,e,f,g,h,i,j;this.beforeLoad(),b=__bind(function(){a!=null&&a.call(this);return this.afterLoad()},this),c=Batman._lookupAllBatmanKeys(this.prototype,"storage"),d=!c.length,d||c.shift();for(g=0,i=c.length;g<i;g++){f=c[g],d=d||!f.length;for(h=0,j=f.length;h<j;h++)e=f[h],e.readAllFromStorage(this,b)}if(d)return b()},e.encode=function(){var a,b,c,d,e,f,g;b=1<=arguments.length?__slice.call(arguments,0):[],Batman._initializeObject(this.prototype),(c=this.prototype._batman).encoders||(c.encoders={}),(d=this.prototype._batman).decoders||(d.decoders={}),g=[];for(e=0,f=b.length;e<f;e++)a=b[e],this.prototype._batman.encoders[a]=function(a){return""+a},g.push(this.prototype._batman.decoders[a]=function(a){return a});return g},e.validate=function(){var a,b,c,d,e,f,g,h,i,j,k,l;a=2<=arguments.length?__slice.call(arguments,0,i=arguments.length-1):(i=0,[]),e=arguments[i++],Batman._initializeObject(this.prototype),g=(h=this.prototype._batman).validators||(h.validators=[]);if(typeof e=="function")return g.push({keys:a,callback:e});d=e,l=[];for(j=0,k=Validators.length;j<k;j++)f=Validators[j],l.push(function(){var e,h;if(c=f.matches(d)){for(e=0,h=c.length;e<h;e++)b=c[e],delete d[b];return g.push({keys:a,validator:new f(c)})}}());return l},e.prototype.mixin(Batman.StateMachine),d=["empty","dirty","loading","loaded","saving"];for(b=0,c=d.length;b<c;b++)a=d[b],e.prototype.state(a);e.prototype.state("saved",function(){return this.dirtyKeys.clear()}),e.prototype.set=function(a,b){var c;c=this[a];if(c!==b){e.__super__.set.apply(this,arguments),this.dirtyKeys.set(a,c);if(this.state()!=="dirty")return this.dirty()}},e.prototype.accessor("dirtyKeys",{get:function(){return this.dirtyKeys}}),e.prototype.toJSON=function(){var a,b,c,d,e,f,g;d={},g=Batman._lookupAllBatmanKeys(this,"encoders");for(e=0,f=g.length;e<f;e++){b=g[e];for(c in b)a=b[c],d[c]=a(this[c])}return d},e.prototype.fromJSON=function(a){var b,c,d,e,f,g,h,i;f={},b=Batman._lookupAllBatmanKeys(this,"decoders");if(!b.length)for(e in a)g=a[e],f[helpers.camelize(e,!0)]=g;else for(h=0,i=b.length;h<i;h++){d=b[h];for(e in d)c=d[e],f[e]=c(a[e])}return this.mixin(f)},e.prototype.beforeLoad=e.event(function(){this.loading();return!0}),e.prototype.afterLoad=e.event(function(){this.loaded();return!0}),e.prototype.beforeCreate=e.event(function(){}),e.prototype.afterCreate=e.event(function(){}),e.prototype.beforeSave=e.event(function(){this.saving();return!0}),e.prototype.afterSave=e.event(function(){this.saved();return!0}),e.prototype.beforeValidation=e.event(function(){}),e.prototype.afterValidation=e.event(function(){}),e.prototype.load=function(a){var b,c,d,e,f,g,h,i,j;this.beforeLoad(),b=__bind(function(){a!=null&&a.call(this);return this.afterLoad()},this),c=Batman._lookupAllBatmanKeys(this,"storage"),d=!c.length;for(g=0,i=c.length;g<i;g++){f=c[g],d=d||!f.length;for(h=0,j=f.length;h<j;h++)e=f[h],e.readFromStorage(this,b)}if(d)return b()},e.prototype.save=function(a){var b,c,d,e,f,g,h,i,j,k;if(!!this.isValid()){this.beforeSave(),d=this.isNew(),d&&this.beforeCreate(),b=__bind(function(){a!=null&&a.call(this),d&&this.afterCreate();return this.afterSave()},this),c=Batman._lookupAllBatmanKeys(this,"storage"),e=!c.length;for(h=0,j=c.length;h<j;h++){g=c[h],e=e||!g.length;for(i=0,k=g.length;i<k;i++)f=g[i],f.writeToStorage(this,b)}if(e)return b()}},e.prototype.validate=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n;this.beforeValidation(),a=!1,m=Batman._lookupAllBatmanKeys(this,"validators");for(g=0,j=m.length;g<j;g++){f=m[g];for(h=0,k=f.length;h<k;h++){e=f[h],d=e.validator,n=e.keys;for(i=0,l=n.length;i<l;i++)b=n[i],c=new Batman.ValidatorPromise(this),d?d.validateEach(c,this,b,this.get(b)):e.callback(c,this,b,this.get(b)),c.paused?(this.prevent("afterValidation"),c.resume(__bind(function(){this.allow("afterValidation");return this.afterValidation()},this)),a=!0):c.canSucceed&&c.success()}}return a?!1:this.afterValidation()},e.prototype.isNew=function(){return this.id==null},e.prototype.accessor({isValid:function(){this.errors.clear();if(this.validate()===!1)return!1;return this.errors.isEmpty()}});return e}(),Batman.ValidatorPromise=function(){function a(a){this.record=a,this.canSucceed=!0}__extends(a,Batman.Object),a.prototype.error=function(a){this.record.errors.add(a);return this.canSucceed=!1},a.prototype.wait=function(){this.paused=!0;return this.canSucceed=!1},a.prototype.resume=a.event(function(){this.paused=!1;return!0}),a.prototype.success=function(){return this.canSucceed=!1};return a}(),Batman.Validator=function(){function a(){var b,c;c=arguments[0],b=2<=arguments.length?__slice.call(arguments,1):[],this.options=c,a.__super__.constructor.apply(this,b)}__extends(a,Batman.Object),a.prototype.validate=function(a){throw"You must override validate in Batman.Validator subclasses."},a.kind=function(){return helpers.underscore(this.name).replace("_validator","")},a.prototype.kind=function(){return this.constructor.kind()},a.options=function(){var a;a=1<=arguments.length?__slice.call(arguments,0):[],Batman._initializeObject(this);return this._batman.options?this._batman.options.concat(a):this._batman.options=a},a.matches=function(a){var b,c,d,e,f,g;c={},d=!1;for(b in a)e=a[b],~((f=this._batman)!=null?(g=f.options)!=null?g.indexOf(b):void 0:void 0)&&(c[b]=e,d=!0);if(d)return c};return a}(),Validators=Batman.Validators=[Batman.LengthValidator=function(){function a(b){var c;if(c=b.lengthIn||b.lengthWithin)b.minLength=c[0],b.maxLength=c[1]||-1,delete b.lengthWithin,delete b.lengthIn;a.__super__.constructor.apply(this,arguments)}__extends(a,Batman.Validator),a.options("minLength","maxLength","length","lengthWithin","lengthIn"),a.prototype.validateEach=function(a,b,c,d){var e;e=this.options,e.minLength&&d.length<e.minLength&&a.error(""+c+" must be at least "+e.minLength+" characters"),e.maxLength&&d.length>e.maxLength&&a.error(""+c+" must be less than "+e.maxLength+" characters");if(e.length&&d.length!==e.length)return a.error(""+c+" must be "+e.length+" characters")};return a}(),Batman.PresenceValidator=function(){function a(){a.__super__.constructor.apply(this,arguments)}__extends(a,Batman.Validator),a.options("presence"),a.prototype.validateEach=function(a,b,c,d){var e;e=this.options;if(e.presence&&d==null)return a.error(""+c+" must be present")};return a}()],Batman.StorageMechanism=function(){function a(a){this.model=a,this.modelKey=helpers.pluralize(helpers.underscore(this.model.name))}a.prototype.isStorageAdapter=!0;return a}(),Batman.LocalStorage=function(){function a(){var b;if(b=!1,__indexOf.call(window,b)>=0)return null;this.id=0,a.__super__.constructor.apply(this,arguments)}__extends(a,Batman.StorageMechanism),a.prototype.writeToStorage=function(a,b){var c,d;d=this.modelKey,c=a.id||(a.id=++this.id),d&&c&&(localStorage[d+c]=JSON.stringify(a));return b()},a.prototype.readFromStorage=function(a,b){var c,d,e;e=this.modelKey,c=a.id,e&&c&&(d=localStorage[e+c]),a.fromJSON(JSON.parse(d));return b()};return a}(),Batman.RestStorage=function(){function a(){a.__super__.constructor.apply(this,arguments)}__extends(a,Batman.StorageMechanism),a.prototype.optionsForRecord=function(a){var b,c,d,e,f;b={type:"JSON"},f=[a,this.model];for(d=0,e=f.length;d<e;d++){c=f[d],c.url?typeof c.url=="function"?b.url=c.url():b.url=c.url:b.url="/"+this.modelKey+"/"+a.id;if(b.url)break}return b},a.prototype.writeToStorage=function(a,b){var c;c=$mixin(this.optionsForRecord(a),{method:id?"put":"post",data:JSON.stringify(a),success:function(){return b()},error:function(a){return b(a)}});return new Batman.Request(c)},a.prototype.readFromStorage=function(a,b){var c;c=$mixin(this.optionsForRecord(a),{method:"GET",success:function(c){var d;typeof c=="string"&&(c=JSON.parse(c));for(d in c){c=c[d];break}a.fromJSON(c);return b()}});return new Batman.Request(c)},a.prototype.readAllFromStorage=function(a,b){var c;c=$mixin(this.optionsForRecord(record),{success:function(c){var d,e,f,g,h;typeof c=="string"&&(c=JSON.parse(c));if(!Array.isArray(c))for(d in c){c=c[d];break}for(g=0,h=c.length;g<h;g++)e=c[g],f=new a(""+e.id),f.fromJSON(e);b()}});return new Batman.Request(c)};return a}(),Batman.View=function(){function b(){b.__super__.constructor.apply(this,arguments)}var a;__extends(b,Batman.Object),a={},b.prototype.source="",b.prototype.html="",b.prototype.node=null,b.prototype.context=null,b.prototype.contexts=null,b.prototype.contentFor=null,b.prototype.ready=b.eventOneShot(function(){}),b.prototype.prefix="views",b.prototype.observe("source",function(){return setTimeout(__bind(function(){return this.reloadSource()},this),0)}),b.prototype.reloadSource=function(){var b;b=this.get("source");if(!!b)return a[b]?this.set("html",a[b]):new Batman.Request({url:"views/"+this.source,type:"html",success:__bind(function(c){a[b]=c;return this.set("html",c)},this),error:function(a){throw"Could not load view from "+url}})},b.prototype.observe("html",function(a){var b;b=this.node||document.createElement("div"),b.innerHTML=a;if(this.node!==b)return this.set("node",b)}),b.prototype.observe("node",function(a){if(!!a){this.ready.fired=!1,this._renderer&&this._renderer.forgetAll();if(a){this._renderer=new Batman.Renderer(a,__bind(function(){var b,c;b=this.contentFor,typeof b=="string"&&(this.contentFor=(c=Batman.DOM._yields)!=null?c[b]:void 0),this.contentFor&&a&&(this.contentFor.innerHTML="",this.contentFor.appendChild(a));return this.ready(a)},this),this.contexts),this.context&&this._renderer.contexts.push(this.context);return this._renderer.contextObject.view=this}}});return b}(),Batman.Renderer=function(){function b(a,c,d){this.node=a,this.callback=c,this.resume=__bind(this.resume,this),this.start=__bind(this.start,this),b.__super__.constructor.apply(this,arguments),this.contexts=d||[Batman.currentApp,new Batman.Object],this.contextObject=this.contexts[1],setTimeout(this.start,0)}var a;__extends(b,Batman.Object),b.prototype.start=function(){this.startTime=new Date;return this.parseNode(this.node)},b.prototype.resume=function(){this.startTime=new Date;return this.parseNode(this.resumeNode)},b.prototype.finish=function(){this.startTime=null;return typeof this.callback=="function"?this.callback():void 0},b.prototype.forgetAll=function(){},a=/data\-(.*)/,b.prototype.parseNode=function(b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p;if(new Date-this.startTime>50)this.resumeNode=b,setTimeout(this.resume,0);else{if(b.getAttribute){this.contextObject.node=b,d=this.contexts,o=b.attributes;for(l=0,m=o.length;l<m;l++){c=o[l],f=(p=c.nodeName.match(a))!=null?p[1]:void 0;if(!f)continue;h=(e=f.indexOf("-"))===-1?typeof (j=Batman.DOM.readers)[f]=="function"?j[f](b,c.value,d,this):void 0:typeof (k=Batman.DOM.attrReaders)[n=f.substr(0,e)]=="function"?k[n](b,f.substr(e+1),c.value,d,this):void 0;if(h===!1){i=!0;break}}}return(g=this.nextNode(b,i))?this.parseNode(g):this.finish()}},b.prototype.nextNode=function(a,b){var c,d,e,f;if(!b){c=a.childNodes;if(c!=null?c.length:void 0)return c[0]}typeof a.onParseExit=="function"&&a.onParseExit(),f=a.nextSibling;if(f)return f;d=a;while(d=d.parentNode){typeof d.onParseExit=="function"&&d.onParseExit(),e=d.nextSibling;if(e)return e}};return b}(),matchContext=function(a,b){var c,d,e;c=b.split(".")[0],e=a.length;while(e--){d=a[e];if(d.get!=null&&d.get(c)!=null||d[c]!=null)return d}return container},Batman.DOM={readers:{bind:function(a,b,c){var d,e;d=matchContext(c,b),e=!0,Batman.DOM.nodeIsEditable(a)&&Batman.DOM.events.change(a,function(){e=!1,d.set(b,a.value);return e=!0});return d.observe(b,!0,function(b){if(e)return Batman.DOM.valueForNode(a,b)})},context:function(a,b,c){var d;d=matchContext(c,b).get(b),c.push(d);return a.onParseExit=function(){var a;a=c.indexOf(d);return c.splice(a,c.length-a)}},mixin:function(a,b,c){var d,e;c.push(Batman.mixins),d=matchContext(c,b),e=d.get(b),c.pop();return $mixin(a,e)},showif:function(a,b,c,d,e){var f,g;g=a.style.display;if(!g||g==="none")g="block";f=matchContext(c,b);return f.observe(b,!0,function(b){return!!b==!e?typeof a.show=="function"?a.show():a.style.display=g:typeof a.hide=="function"?a.hide():a.style.display="none"})},hideif:function(){var a,b;a=1<=arguments.length?__slice.call(arguments,0):[];return(b=Batman.DOM.readers).showif.apply(b,__slice.call(a).concat([!0]))},route:function(a,b,c){var d,e,f,g,h,i,j,k;b.substr(0,1)==="/"?(i=Batman.redirect.bind(Batman,b),j=b):(h=b.indexOf("#"))!==-1?(f=helpers.camelize(b.substr(0,h))+"Controller",d=matchContext(c,f),e=d[f],i=e!=null?e.sharedInstance()[b.substr(h+1)]:void 0,j=i!=null?i.pattern:void 0):(d=matchContext(c,b),i=d.get(b),i instanceof Batman.Model?(f=helpers.camelize(helpers.pluralize(b))+"Controller",d=matchContext(c,f),e=d[f].sharedInstance(),g=i.id,i=(k=e.show)!=null?k.bind(e,{id:g}):void 0,j="/"+helpers.pluralize(b)+"/"+g):j=i!=null?i.pattern:void 0),a.nodeName.toUpperCase()==="A"&&(a.href=Batman.HASH_PATTERN+(j||""));return Batman.DOM.events.click(a,function(){return i()})},partial:function(a,b,c){var d;return d=new Batman.View({source:b+".html",contentFor:a,contexts:Array.prototype.slice.call(c)})},yield:function(a,b){return setTimeout(function(){return Batman.DOM.yield(b,a)},0)},contentfor:function(a,b){return setTimeout(function(){return Batman.DOM.contentFor(b,a)},0)}},attrReaders:{bind:function(a,b,c,d){var e,f,g,h,i,j,k;i=c.split(/\s*\|\s*/),c=i.shift();if(i.length){k=[];while(h=i.shift()){e=h.split(" "),h=e.shift(),g=Batman.filters[h]||Batman.helpers[h];if(!g)continue;c.substr(0,1)==="@"&&(c=c.substr(1),f=matchContext(d,c),c=f.get(c)),j=g.apply(null,[c].concat(__slice.call(e),[a])),k.push(a.setAttribute(b,j))}return k}f=matchContext(d,c),f.observe(c,!0,function(c){return b==="value"?a.value=c:a.setAttribute(b,c)});if(b==="value")return Batman.DOM.events.change(a,function(){j=a.value,j==="false"&&(j=!1),j==="true"&&(j=!0);return f.set(c,j)})},context:function(a,b,c,d){var e,f;e=matchContext(d,c).get(c),f=new Batman.Object,f[b]=e,d.push(f);return a.onParseExit=function(){var a;a=d.indexOf(e);return d.splice(a,d.length-a)}},event:function(a,b,c,d){var e,f;c.substr(0,1)==="@"?e=new Function(c.substr(1)):(f=matchContext(d,c),e=f.get(c));return Batman.DOM.events[b](a,function(){var b;b=a.getAttribute("data-confirm");if(!b||!!confirm(b))return e!=null?e.apply(f,arguments):void 0})},addclass:function(a,b,c,d,e,f){var g;b=b.replace(/\|/g," "),g=matchContext(d,c);return g.observe(c,!0,function(c){var d,e;d=a.className,e=d.indexOf(b)!==-1;if(!!c==!f){if(!e)return a.className=""+d+" "+b}else if(e)return a.className=d.replace(b,"")})},removeclass:function(){var a,b;a=1<=arguments.length?__slice.call(arguments,0):[];return(b=Batman.DOM.attrReaders).addclass.apply(b,__slice.call(a).concat([!0]))},foreach:function(a,b,c,d,e){var f,g,h,i,j,k,l,m;l=a.cloneNode(!0),l.removeAttribute("data-foreach-"+b),k=a.parentNode,k.removeChild(a),j=new Batman.Hash,i=Array.prototype.slice.call(d),h=matchContext(d,c),g=h.get(c);if(g!=null?g.observe:void 0)g.observe("add",f=function(a){var c,d,f,g;f=l.cloneNode(!0),j.set(a,f),g=new Batman.Renderer(f,function(){k.appendChild(f);return e.allow("ready")}),g.contexts=d=Array.prototype.slice.call(i),g.contextObject=Batman(d[1]),c=new Batman.Object,c[b]=a,d.push(c);return d.push(a)}),g.observe("remove",m=function(a){var b,c;b=j.get(a);return b!=null?(c=b.parentNode)!=null?c.removeChild(b):void 0:void 0}),g.observe("sort",function(){g.each(m);return setTimeout(function(){return g.each(f)},0)}),g.each(function(a){e.prevent("ready");return f(a)});return!1}},events:{click:function(a,b){Batman.DOM.addEventListener(a,"click",function(a){b!=null&&b.apply(this,arguments);return a.preventDefault()});if(a.nodeName.toUpperCase()==="A"&&!a.href)return a.href="#"},change:function(a,b){var c;c=function(){switch(a.nodeName.toUpperCase()){case"TEXTAREA":return"keyup";case"INPUT":return a.type.toUpperCase()==="TEXT"?"keyup":"change";default:return"change"}}();return Batman.DOM.addEventListener(a,c,b)},submit:function(a,b){return Batman.DOM.nodeIsEditable(a)?Batman.DOM.addEventListener(a,"keyup",function(a){if(a.keyCode===13){b.apply(this,arguments);return a.preventDefault()}}):Batman.DOM.addEventListener(a,"submit",function(a){b.apply(this,arguments);return a.preventDefault()})}},yield:function(a,b){var c,d,e,f;d=(e=Batman.DOM)._yields||(e._yields={}),d[a]=b;if(c=(f=Batman.DOM._yieldContents)!=null?f[a]:void 0){b.innerHTML="";if(c)return b.appendChild(c)}},contentFor:function(a,b){var c,d,e,f;c=(e=Batman.DOM)._yieldContents||(e._yieldContents={}),c[a]=b;if(d=(f=Batman.DOM._yields)!=null?f[a]:void 0){d.innerHTML="";if(b)return d.appendChild(b)}},valueForNode:function(a,b){var c;c=arguments.length>1;switch(a.nodeName.toUpperCase()){case"INPUT":return c?a.value=b:a.value;default:return c?a.innerHTML=b:a.innerHTML}},nodeIsEditable:function(a){var b;return(b=a.nodeName.toUpperCase())==="INPUT"||b==="TEXTAREA"},addEventListener:function(a,b,c){return a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,c)}},camelize_rx=/(?:^|_)(.)/g,capitalize_rx=/(^|\s)([a-z])/g,underscore_rx1=/([A-Z]+)([A-Z][a-z])/g,underscore_rx2=/([a-z\d])([A-Z])/g,helpers=Batman.helpers={camelize:function(a,b){a=a.replace(camelize_rx,function(a,b){return b.toUpperCase()});return b?a.substr(0,1).toLowerCase()+a.substr(1):a},underscore:function(a){return a.replace(underscore_rx1,"$1_$2").replace(underscore_rx2,"$1_$2").replace("-","_").toLowerCase()},singularize:function(a){return a.substr(-3)==="ies"?a.substr(0,a.length-3)+"y":a.substr(-1)==="s"?a.substr(0,a.length-1):a},pluralize:function(a,b){if(b){if(a===1)return b}else b=a;return b.substr(-1)==="y"?""+b.substr(0,b.length-1)+"ies":""+b+"s"},capitalize:function(a){return a.replace(capitalize_rx,function(a,b,c){return b+c.toUpperCase()})}},filters=Batman.filters={},mixins=Batman.mixins=new Batman.Object,container=typeof exports!="undefined"&&exports!==null?(exports.Batman=Batman,global):(window.Batman=Batman,window),$mixin(container,Batman.Observable),Batman.exportHelpers=function(a){a.$mixin=$mixin,a.$unmixin=$unmixin,a.$route=$route,a.$redirect=$redirect,a.$event=$event;return a.$eventOneShot=$eventOneShot},Batman.exportGlobals=function(){return Batman.exportHelpers(container)},!function(window){function readyState(a,b,c){return function(){a&&a.readyState==4&&(twoHundo.test(a.status)?b(a):c(a))}}function setHeaders(a,b){var c=b.headers||{};c.Accept="text/javascript, text/html, application/xml, text/xml, */*",c["X-Requested-With"]=c["X-Requested-With"]||"XMLHttpRequest";if(b.data){c["Content-type"]="application/x-www-form-urlencoded";for(var d in c)c.hasOwnProperty(d)&&a.setRequestHeader(d,c[d],!1)}}function getCallbackName(a){var b=a.jsonpCallback||"callback";if(a.url.substr(-(b.length+2))==b+"=?"){var c="reqwest_"+uniqid++;a.url=a.url.substr(0,a.url.length-1)+c;return c}var d=new RegExp(b+"=([\\w]+)");return a.url.match(d)[1]}function getRequest(a,b,c){if(a.type!="jsonp"){var d=xhr();d.open(a.method||"GET",typeof a=="string"?a:a.url,!0),setHeaders(d,a),d.onreadystatechange=readyState(d,b,c),a.before&&a.before(d),d.send(a.data||null);return d}var e=doc.createElement("script"),f=getCallbackName(a);window[f]=function(b){a.success&&a.success(b)},e.type="text/javascript",e.src=a.url,e.async=!0,e.onload=function(){head.removeChild(e),delete window[f]},head.insertBefore(e,topScript)}function Reqwest(a,b){this.o=a,this.fn=b,init.apply(this,arguments)}function setType(a){if(/\.json$/.test(a))return"json";if(/\.jsonp$/.test(a))return"jsonp";if(/\.js$/.test(a))return"js";if(/\.html?$/.test(a))return"html";if(/\.xml$/.test(a))return"xml";return"js"}function init(o,fn){function complete(a){o.complete&&o.complete(a)}function success(resp){o.timeout&&clearTimeout(self.timeout)&&(self.timeout=null);var r=resp.responseText;switch(type){case"json":resp=eval("("+r+")");break;case"js":resp=eval(r);break;case"html":resp=r}fn(resp),o.success&&o.success(resp),complete(resp)}function error(a){o.error&&o.error(a),complete(a)}this.url=typeof o=="string"?o:o.url,this.timeout=null;var type=o.type||setType(this.url),self=this;fn=fn||function(){},o.timeout&&(this.timeout=setTimeout(function(){self.abort(),error()},o.timeout)),this.request=getRequest(o,success,error)}function reqwest(a,b){return new Reqwest(a,b)}function enc(a){return encodeURIComponent(a)}function serial(a){var b=a.name;if(a.disabled||!b)return"";b=enc(b);switch(a.tagName.toLowerCase()){case"input":switch(a.type){case"reset":case"button":case"image":case"file":return"";case"checkbox":case"radio":return a.checked?b+"="+(a.value?enc(a.value):!0)+"&":"";default:return b+"="+(a.value?enc(a.value):!0)+"&"}break;case"textarea":return b+"="+enc(a.value)+"&";case"select":return b+"="+enc(a.options[a.selectedIndex].value)+"&"}return""}var twoHundo=/^20\d$/,doc=document,byTag="getElementsByTagName",topScript=doc[byTag]("script")[0],head=topScript.parentNode,xhr="XMLHttpRequest"in window?function(){return new XMLHttpRequest}:function(){return new ActiveXObject("Microsoft.XMLHTTP")},uniqid=0;Reqwest.prototype={abort:function(){this.request.abort()},retry:function(){init.call(this,this.o,this.fn)}},reqwest.serialize=function(a){var b=a[byTag]("input"),c=a[byTag]("select"),d=a[byTag]("textarea");return(v(b).chain().toArray().map(serial).value().join("")+v(c).chain().toArray().map(serial).value().join("")+v(d).chain().toArray().map(serial).value().join("")).replace(/&$/,"")},reqwest.serializeArray=function(a){for(var b=this.serialize(a).split("&"),c=0,d=b.length,e=[],f;c<d;c++)b[c]&&(f=b[c].split("="))&&e.push({name:f[0],value:f[1]});return e};var old=window.reqwest;reqwest.noConflict=function(){window.reqwest=old;return this},window.reqwest=reqwest}(this),(typeof exports!="undefined"&&exports!==null?exports:this).reqwest=typeof window!="undefined"&&window!==null?window.reqwest:reqwest,Batman.Request.prototype.send=function(a){this.loading(!0);return reqwest({url:this.get("url"),method:this.get("method"),type:this.get("type"),data:a||this.get("data"),success:__bind(function(a){this.set("response",a);return this.success(a)},this),failure:__bind(function(a){this.set("response",a);return this.error(a)},this),complete:__bind(function(){this.loading(!1);return this.loaded(!0)},this)})}}).call(this)