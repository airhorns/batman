<!DOCTYPE html>
<html>
<head>
    <title>Alfred: Batman's Todos</title>

    <link href='http://fonts.googleapis.com/css?family=Lobster' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/examples/resources/alfred.css" type="text/css">

    <script type="text/javascript" src="/lib/coffee-script.js"></script>
    <script type="text/coffeescript" src="/src/batman.coffee"></script>
    <script type="text/coffeescript" src="/src/batman.solo.coffee"></script>
</head>

<body>
    <div id="container">
        <h1>Alfred</h1>
        <form data-formfor-todo="TodoController.todo" data-event-submit="TodoController.create">
          <input class="new-item" placeholder="add a todo item" data-bind="todo.body"/>
        </form>

        <ul id="items">
            <li data-foreach-todo="Todo.all" data-mixin="animation">
                <input type="checkbox" data-bind="todo.isDone" />
                <label data-bind="todo.body" data-addclass-done="todo.isDone"</label>
                <a data-event-click="todo.destroy">delete</a>
            </li>
            <li><span data-bind="Todo.all.length"></span> <span data-bind="'item' | pluralize Todo.all.length"></span>
        </ul>
    </div>

    <script type="text/coffeescript">
    # Create our application and namespace.
    class Alfred extends Batman.App
      @global yes

    class Alfred.TodoControllerClass extends Batman.Controller
      @global yes

      # Add some example todos to show off.
      index: @route('/', ->
        Todo.load (err, todos) ->
          throw err if err?
          if Todo.get('all').length == 0
            error = (err) -> throw err if err?
            new Todo(body: 'joker escaped arkham again', isDone: true).save(error)
            new Todo(body: 'riddler sent riemann hypothesis').save(error)
            new Todo(body: 'bane wants to meet, not worried').save(error)
        return false
      )

      constructor: ->
        super
        @set 'todo', new Todo

      create: =>
        @todo.save (err) =>
          throw err if err?
          @set 'todo', new Todo
        return false


    # Define the principle Todo model with `body` and `isDone` attributes, and tell it to persit itself using Local Storage.
    class Alfred.Todo extends Batman.Model
      @global yes

      @persist Batman.LocalStorage
      @encode 'body', 'isDone'

      body: ''
      isDone: false

    # Start the app, making it start to listen to route change events.
    window.TodoController = TodoControllerClass.sharedInstance()
    Alfred.run()
    </script>
</body>
</html>

